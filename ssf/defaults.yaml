# -*- coding: utf-8 -*-
# vim: ft=yaml
---
ssf_node_anchors:
  defaults:
    formula: &formula_default
      context: &context_default
        git:
          branch:
            # TODO: `base` can be removed in favour of `github:remote:upstream:branch`
            base: master
            pr: chore/standardise-structure
            upstream: upstream
          commit:
            # NOTE: The version number in the `body` is automatically updated during the
            #       release phase via. `pre-commit_semantic-release.sh`
            #       An alternative method could be to use:
            #       `git describe --abbrev=0 --tags`
            # yamllint disable rule:line-length
            title: 'feat(tofs): implementation for all file.managed'
            body: '* Checked using https://github.com/myii/ssf-formula/pull/54'
            # yamllint enable rule:line-length
          github:
            owner: saltstack-formulas
            repo: ''
            remote:
              upstream:
                name: upstream
                branch: master
              fork:
                name: origin
                branch: master
        inspec_suites_kitchen: &isk_default
          0: &isk_suite_default
            name: default
            # If both `includes` and `excludes` are provided,
            # only `includes` will be considered, mimicking `kitchen list`
            # Note: This applies automatically via. `kitchen.yml`
            #       but is applied manually in the matrix (Travis/Cirrus)
            # Note: Cannot rely on `kitchen list` since there could end up being
            #       far too many entries (e.g. `vault-formula` & `iptables-formula`)
            #       Hence, the inclusion of `platforms_matrix_commented_includes`
            # yamllint disable-line rule:line-length
            # Ref: https://github.com/test-kitchen/test-kitchen/blob/7ce894e74f828f9e36531cf2d74588dd74fbf240/lib/kitchen/config.rb#L183-L193
            excludes: []
            includes: []
            inspec_yml:
              depends: []
              summary: >-
                Verify that the formula is setup and configured correctly
              supports:
                - debian
                - ubuntu
                - centos
                - fedora
                - opensuse
                - suse
                - freebsd
                - amazon
                - arch
            provisioner:
              dependencies: []
              # Structure assumes `top.sls:base`
              pillars:
                - '*':
                    - .
              pillars_from_files:
                - .sls: pillar.example
              # Structure assumes `base`
              state_top:
                - '*':
                    - .
            verifier:
              inspec_tests_path_prefix: test/integration
              test_suite: .
        inspec_suites_matrix:
          - default
        platforms:
          # Could use `opensuse-leap` throughout since `/` never used at this end
          # Would have to modify the `if` in the `kitchen.yml` template(s), though
          # Also, may have to be careful with versions such as `18.04` being seen
          # as numbers (for comparisons)
          # [os           , os_ver, salt_ver, py_ver]

          ### `develop-py3`
          - [debian       ,  10   ,  develop,      3]
          # - [debian       ,   9   ,  develop,      3]  # unmaintained
          - [ubuntu       ,  18.04,  develop,      3]
          - [centos       ,   7   ,  develop,      3]
          - [fedora       ,  30   ,  develop,      3]
          # - [fedora       ,  29   ,  develop,      3]  # unmaintained
          - [opensuse/leap,  15   ,  develop,      3]

          ### `develop-py2`
          - [amazonlinux  ,   2   ,  develop,      2]
          - [arch-base    , latest,  develop,      2]

          ### `2019.2-py3`
          - [debian       ,   9   ,   2019.2,      3]    # unmaintained (resolve)
          - [ubuntu       ,  18.04,   2019.2,      3]
          # - [ubuntu       ,   1804,   2019.2,      3]  # unmaintained
          - [centos       ,   7   ,   2019.2,      3]
          - [fedora       ,  30   ,   2019.2,      3]
          # - [fedora       ,  29   ,   2019.2,      3]  # unmaintained
          - [opensuse/leap,  15   ,   2019.2,      3]

          ### `2019.2-py2`
          # - [debian       ,  10   ,   2019.2,      2]
          # - [debian       ,   9   ,   2019.2,      2]  # unmaintained
          # - [ubuntu       ,  18.04,   2019.2,      2]
          # - [centos       ,   7   ,   2019.2,      2]
          # - [fedora       ,  29   ,   2019.2,      2]  # unmaintained
          # - [opensuse/leap,  15   ,   2019.2,      2]  # unmaintained
          - [amazonlinux  ,   2   ,   2019.2,      2]
          - [arch-base    , latest,   2019.2,      2]

          ### `2018.3-py3`
          # - [fedora       ,  29   ,   2018.3,      3]

          ### `2018.3-py2`
          # - [debian       ,  10   ,   2018.3,      2]
          - [debian       ,   9   ,   2018.3,      2]
          # - [debian       ,   8   ,   2018.3,      2]  # unmaintained
          # - [ubuntu       ,  18.04,   2018.3,      2]
          - [ubuntu       ,  16.04,   2018.3,      2]
          # - [ubuntu       ,  1604 ,   2018.3,      2]  # unmaintained
          - [centos       ,   7   ,   2018.3,      2]
          # - [centos       ,   6   ,   2018.3,      2]
          - [fedora       ,  29   ,   2018.3,      2]    # unmaintained (resolve)
          # - [fedora       ,  28   ,   2018.3,      2]  # unmaintained
          - [opensuse/leap,  15   ,   2018.3,      2]
          # - [opensuse/leap,  42   ,   2018.3,      2]  # unmaintained
          # - [opensuse     ,  423  ,   2018.3,      2]  # unmaintained
          - [amazonlinux  ,   2   ,   2018.3,      2]
          - [arch-base    , latest,   2018.3,      2]

          ### `2017.7-py2`
          # - [debian       ,   9   ,   2017.7,      2]
          - [debian       ,   8   ,   2017.7,      2]    # unmaintained (resolve)
          - [ubuntu       ,  16.04,   2017.7,      2]
          - [centos       ,   6   ,   2017.7,      2]
          - [fedora       ,  29   ,   2017.7,      2]
          # - [fedora       ,  28   ,   2017.7,      2]  # unmaintained
          - [opensuse/leap,  15   ,   2017.7,      2]
          # - [opensuse/leap,  42   ,   2017.7,      2]  # unmaintained
          - [amazonlinux  ,   2   ,   2017.7,      2]
          - [arch-base    , latest,   2017.7,      2]

        platforms_matrix:
          # Comments in `platforms` apply here, too
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,  develop,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          - [arch-base    , latest,   2019.2,      2,         default]
          - [fedora       ,  29   ,   2018.3,      2,         default]
          - [opensuse/leap,  15   ,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
        # To deal with excessive instances when mimicking `kitchen list -b`
        # If values are set, only use these as commented entries in the matrix
        platforms_matrix_commented_includes: []
        script_kitchen:
          bin: bin/kitchen
          cmd: verify
          pre: []
          post: []
        travis:
          addons: {}
          dist: bionic
        use_cirrus_ci: false
        use_tofs: false
        yamllint:
          extends: default
          ignore:
            default:
              - 'node_modules/'
            additional_ssf:
              - 'test/**/states/**/*.sls'
              - '.kitchen/'
            additional: []
          yaml-files:
            default:
              - '*.yaml'
              - '*.yml'
              - '.yamllint'
            additional_ssf:
              - '*.example'
              - 'test/**/*.sls'
            additional: []
          rules:
            # yamllint disable rule:comments-indentation
            # Commenting out all of the rules that haven't been implemented yet
            # braces: {}
            # brackets: {}
            # colons: {}
            commas: {}
            # comments: {}
            comments-indentation: {}
            # document-end: {}
            # document-start: {}
            # empty-lines: {}
            empty-values:
              forbid-in-block-mappings: 'true'
              forbid-in-flow-mappings: 'true'
            # hyphens: {}
            # indentation: {}
            key-duplicates: {}
            # key-ordering: {}
            line-length:
              bugbear: 88
              default: 80
              max: 88
            # new-line-at-end-of-file: {}
            # new-lines: {}
            octal-values:
              forbid-implicit-octal: 'true'
              forbid-explicit-octal: 'true'
            # quoted-strings: {}
            # trailing-spaces: {}
            # truthy: {}
            # yamllint enable rule:comments-indentation

ssf:
  active:
    semrel_formulas: []
    semrel_files: []
  git:
    commit:
      options: ''
    github:
      user: ''
      file_api_response: github_api_response
    states:
      prepare:
        active: false
        source: salt://ssf/files/default/git/git_10_prepare.sh
      add_rm:
        active: false
        source: ''
      commit_push:
        active: false
        source: salt://ssf/files/default/git/git_20_commit_push.sh
        push:
          active: false
          # Push commit via. PR; if not, push directly to the repo's main branch
          via_PR: true
      create_PR:
        active: false
        source: salt://ssf/files/default/git/git_30_create_PR.sh
  semrel_formulas:
    apt:
      <<: *formula_default
      context:
        <<: *context_default
        inspec_suites_kitchen:
          <<: *isk_default
          0:
            <<: *isk_suite_default
            name: repositories
          1:
            <<: *isk_suite_default
            name: preferences
    apt-cacher: *formula_default
    bind: *formula_default
    cert: *formula_default
    chrony: *formula_default
    collectd: *formula_default
    cron: *formula_default
    deepsea: *formula_default
    dhcpd: *formula_default
    exim: *formula_default
    fail2ban: *formula_default
    golang: *formula_default
    grafana: *formula_default
    influxdb: *formula_default
    iptables:
      <<: *formula_default
      context:
        <<: *context_default
        inspec_suites_kitchen:
          <<: *isk_default
          1:
            <<: *isk_suite_default
            name: tables
    keepalived: *formula_default
    libvirt:
      <<: *formula_default
      context:
        <<: *context_default
        inspec_suites_kitchen:
          <<: *isk_default
          1:
            <<: *isk_suite_default
            name: share
          2:
            <<: *isk_suite_default
            name: clean
    locale:
      <<: *formula_default
      context:
        <<: *context_default
        inspec_suites_kitchen:
          <<: *isk_default
          1:
            <<: *isk_suite_default
            name: fedora
    logrotate: *formula_default
    lvm: *formula_default
    mysql: *formula_default
    nginx: *formula_default
    openssh: *formula_default
    openvpn: *formula_default
    packages:
      <<: *formula_default
      context:
        <<: *context_default
        inspec_suites_kitchen:
          <<: *isk_default
          1:
            <<: *isk_suite_default
            name: deb
          2:
            <<: *isk_suite_default
            name: ubu18
          3:
            <<: *isk_suite_default
            name: ubu16
          4:
            <<: *isk_suite_default
            name: fed
          5:
            <<: *isk_suite_default
            name: sus
          6:
            <<: *isk_suite_default
            name: rpm
    php:
      <<: *formula_default
      context:
        <<: *context_default
        inspec_suites_kitchen:
          <<: *isk_default
          1:
            <<: *isk_suite_default
            name: debian
          2:
            <<: *isk_suite_default
            name: ubuntu
          3:
            <<: *isk_suite_default
            name: redhat
          4:
            <<: *isk_suite_default
            name: suse
    postfix: *formula_default
    postgres: *formula_default
    prometheus: *formula_default
    redis: *formula_default
    rkhunter:
      <<: *formula_default
      context:
        <<: *context_default
        inspec_suites_kitchen:
          <<: *isk_default
          1:
            <<: *isk_suite_default
            name: debian
          2:
            <<: *isk_suite_default
            name: redhat
          3:
            <<: *isk_suite_default
            name: suse
    salt:
      <<: *formula_default
      context:
        <<: *context_default
        inspec_suites_kitchen:
          <<: *isk_default
          0:
            <<: *isk_suite_default
            name: v201902-py3
          1:
            <<: *isk_suite_default
            name: v201902-py2
          2:
            <<: *isk_suite_default
            name: v201803-py2
          3:
            <<: *isk_suite_default
            name: v201707-py2
    ssf: *formula_default
    stack: *formula_default
    stunnel: *formula_default
    sudoers: *formula_default
    sysctl: *formula_default
    syslog-ng: *formula_default
    sysstat: *formula_default
    systemd: *formula_default
    telegraf: *formula_default
    template:
      <<: *formula_default
      context:
        <<: *context_default
        inspec_suites_kitchen:
          <<: *isk_default
          1:
            <<: *isk_suite_default
            name: centos6
    timezone: *formula_default
    ufw: *formula_default
    users: *formula_default
    vault:
      <<: *formula_default
      context:
        <<: *context_default
        inspec_suites_kitchen:
          <<: *isk_default
          0:
            <<: *isk_suite_default
            name: install_binary
          1:
            <<: *isk_suite_default
            name: dev_server
          2:
            <<: *isk_suite_default
            name: prod_server
          3:
            <<: *isk_suite_default
            name: ''
    vim: *formula_default
    vsftpd: *formula_default
